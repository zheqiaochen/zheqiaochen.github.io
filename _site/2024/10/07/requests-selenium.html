<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Jekyll v3.9.5">
<meta property="og:title" content="Try Requests If You Don’t Like Selenium">
<meta name="author" content="Zheqiao Chen">
<meta property="og:locale" content="en">
<meta name="description" content="Recently, I struggled to scrape data from a website built with Vue.js. When I tried to scrape the web data using the traditional Selenium approach, I encountered two problems:">
<meta property="og:description" content="Recently, I struggled to scrape data from a website built with Vue.js. When I tried to scrape the web data using the traditional Selenium approach, I encountered two problems:">
<link rel="canonical" href="http://localhost:4000/2024/10/07/requests-selenium">
<meta property="og:url" content="http://localhost:4000/2024/10/07/requests-selenium">
<meta property="og:site_name" content="Zheqiao Chen’s Personal Website">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-10-07T00:00:00-04:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Try Requests If You Don’t Like Selenium">
<meta name="twitter:site" content="@zheqiaoc">
<meta name="twitter:creator" content="@zheqiaoc"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zheqiao Chen","url":"zheqiaoc.com"},"dateModified":"2024-10-07T00:00:00-04:00","datePublished":"2024-10-07T00:00:00-04:00","description":"Recently, I struggled to scrape data from a website built with Vue.js. When I tried to scrape the web data using the traditional Selenium approach, I encountered two problems:","headline":"Try Requests If You Don’t Like Selenium","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2024/10/07/requests-selenium"},"url":"http://localhost:4000/2024/10/07/requests-selenium"}</script><title> Try Requests If You Don’t Like Selenium - Zheqiao Chen's Personal Website</title>
<link href="/favicon.png" rel="shortcut icon" media="(prefers-color-scheme: light)">
<link href="/favicon_dark.png" rel="shortcut icon" media="(prefers-color-scheme: dark)">
<link rel="alternate" type="application/atom+xml" title="Zheqiao Chen's Personal Website" href="/atom.xml">
<link rel="alternate" type="application/json" title="Zheqiao Chen's Personal Website" href="http://localhost:4000/feed.json">
<link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-KZJB8RH97S"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KZJB8RH97S'); </script><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}:root{--primary-text: #1a1a1a;--secondary-text: #262626;--accent-color: #1a1a1a;--bg-color: #ffffff;--border-color: #d1d1d1;--hover-color: #333333;--code-bg: #fafafa;--blockquote-bg: #fafafa}@font-face{font-family:'Source Han Serif CN';src:local("Source Han Serif CN"),local("Source Han Serif SC"),local("Source Han Serif TC"),local("Source Han Serif TW"),local("Source Han Serif"),local("Noto Serif CJK SC"),local("Songti SC"),local("SimSong"),url("https://cdn.jsdelivr.net/gh/yihui/cron/fonts/SourceHanSerifCN-Regular-yihui.woff2") format("woff2");font-display:swap}@font-face{font-family:'Kai SC';src:local("Kaiti"),local("Kaiti SC"),local("STKaiti"),local("楷体"),local("SimKai"),local("AR PL KaitiM GB"),local("DFKai-SB"),local("FandolKai"),url("https://cdn.jsdelivr.net/gh/yihui/cron/fonts/gkai00mp-yihui.woff2") format("woff2");font-display:swap}body{font-family:Palatino, 'Palatino Linotype', 'Palatino LT STD', 'Latin Modern Roman', 'Source Han Serif CN', 'Noto Serif CJK SC', serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.8;font-size:1rem;color:var(--primary-text);background-color:var(--bg-color);max-width:100ch;margin:0 auto}nav ul{border-right:1px solid var(--border-color)}a{color:var(--accent-color);text-decoration:none;transition:all 0.2s ease}a:hover{color:var(--hover-color)}pre,code{font-family:Consolas, 'SF Mono', Monaco, 'Lucida Console', 'Courier New', 'Kai SC', monospace;font-size:0.95em;background:transparent}pre{margin:0;padding:0.5rem 0;overflow-x:auto;position:relative;padding-right:60px}pre code{padding:0;background:transparent;font-size:0.9em;line-height:1.6}.post{margin-bottom:3rem}.post-content{margin-bottom:4rem}.post p,.post h1,.post h2,.post h3,.post h4,.meta,li{margin:1rem 0}.post h1,.post h2,.post h3,.post h4,h1,h2,h3,h4,h5{line-height:1.3;font-weight:600}.post h4{margin-bottom:0.5rem;line-height:1.2}.post h2:first-child,.project h2:first-child,.photo h2:first-child,section h1:first-child{margin-top:0}header,section{padding:1rem}header li{margin-bottom:.2rem;text-align:right;margin-right:1rem}header a{text-decoration:none}header a.active{font-weight:bold}blockquote{font-family:'Palatino Linotype', 'Book Antiqua', Palatino, 'Kai SC', serif;margin:2rem 0;padding:1rem 1.5rem;border-left:4px solid var(--accent-color);background-color:var(--blockquote-bg);border-radius:0 6px 6px 0;font-style:normal;color:var(--secondary-text)}strong,b{font-weight:bold;font-size:0.9em}.photos ul,.posts ul,header ul{list-style:none}.posts li{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}.post ul,.project ul,.post ol{list-style-position:inside;margin-left:1rem;padding-left:1rem}img{max-width:100%}hr{background:#000000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}pre code{border:none}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem;padding-left:1.2rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid var(--border-color);padding-bottom:2rem}nav ul{border-right:0}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:77%;display:flex;flex-direction:column;margin-bottom:0;padding-bottom:0}figcaption{font-size:0.85rem}@media print{.no-print,.no-print *{display:none !important}}li{margin:4px 0;font-size:0.95rem}.highlight{border:1px solid var(--border-color);border-radius:8px;background-color:var(--code-bg);margin:1.5rem 0;position:relative;padding:1.2rem}.highlight:hover{box-shadow:0 2px 8px rgba(26,26,26,0.1);transition:box-shadow 0.2s ease}.highlight pre{margin:0;padding:0;background:transparent;border:none;overflow-x:auto}.highlight pre code{padding:0;background:transparent;border:none}.copy-code-button{position:absolute;top:0.8rem;right:0.8rem;background-color:var(--bg-color);color:var(--accent-color);padding:5px 10px;font-size:0.8rem;border:1px solid var(--border-color);border-radius:4px;cursor:pointer;z-index:10;transition:all 0.2s ease;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif}.copy-code-button:hover{background-color:var(--accent-color);color:var(--bg-color);border-color:var(--accent-color)}.copy-code-button:active{transform:scale(0.98)}.highlight .c,.highlight .cm,.highlight .c1{color:#595959;font-style:italic}.highlight .err,.highlight .ne{color:#a61717;background-color:#e3d2d2}.highlight .k,.highlight .o,.highlight .kc,.highlight .kd,.highlight .kp,.highlight .kr{font-weight:bold}.highlight .m,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:#d69e2e}.highlight .s,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .s2,.highlight .se,.highlight .sh,.highlight .si,.highlight .sx,.highlight .sr,.highlight .s1,.highlight .ss{color:#262626}.highlight .nc,.highlight .kt{color:#445588;font-weight:bold}.highlight .gd{color:#000;background-color:#ffdddd}.highlight .gi{color:#000;background-color:#ddffdd}.highlight .na,.highlight .nv,.highlight .no,.highlight .ni,.highlight .vg,.highlight .vc,.highlight .vi{color:#1a1a1a}.post h1,h1{font-size:2.2rem;margin-bottom:2rem;color:var(--primary-text)}.post h2,h2{font-size:1.5rem;margin-top:1.8rem;padding-bottom:0.5rem;border-bottom:1px solid var(--border-color);color:var(--primary-text)}.post h3,h3{font-size:1.3rem}.post h4,h4{font-size:1.15rem}h5{font-size:1rem}#vcomments{margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid var(--border-color);margin-bottom:0}.post p a,.post li a{color:var(--accent-color);text-decoration:underline;text-underline-offset:2px;text-decoration-thickness:1px}.post p a:hover,.post li a:hover{color:var(--hover-color)}em{font-family:'Palatino Linotype', 'Book Antiqua', Palatino, 'Kai SC', serif;font-style:normal}</style>
<script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} }); </script> <script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/assets/js/copyCode.js"></script>
</head>
<body><main><header aria-hidden="true" class="no-print"> <!--<h1 class="logo">Zheqiao Chen's Personal Website</h1>--><nav role="navigation" aria-hidden="true"><ul>
<li><a href="/">Writing</a></li>
<li><a href="/about">About</a></li>
<li><a href="/search">Search</a></li>
<li><a href="/rss.xml">RSS</a></li>
</ul></nav></header> ...<title>Try Requests If You Don’t Like Selenium</title>
<section class="post"><h2>Try Requests If You Don’t Like Selenium</h2>
<ul>
<li><a href="#captcha-solver">Captcha Solver</a></li>
<li><a href="#try-requests-if-you-have-trouble-setting-selenium">Try Requests if You Have Trouble Setting Selenium</a></li>
<li><a href="#captcha-solver--requests">Captcha Solver + Requests</a></li>
</ul>
<p>Recently, I struggled to scrape data from a website built with Vue.js. When I tried to scrape the web data using the traditional Selenium approach, I encountered two problems:</p>
<ol>
<li>Captchas appeared when I tried to load more pages.</li>
<li>Since the site is built with a JavaScript framework, the web page is not static. Accessing information on subpages using Selenium took a lot of time, and the URL did not change, which posed an additional challenge for Selenium.</li>
</ol>
<p>I’d like to share how I dealt with these issues.</p>
<h2 id="captcha-solver">Captcha Solver</h2>
<p>Initially, I tried using Chrome extensions to automatically solve captchas while using Selenium to load pages, but they didn’t work well. So, I turned to alternative solutions. I found a Chinese company that provides an excellent service. They offer a Python code snippet that solves captchas with the following process:</p>
<ol>
<li>Locate the captcha’s XPath</li>
<li>Download the captcha image</li>
<li>Upload the captcha image to their server</li>
<li>Return the solved captcha value</li>
</ol>
<p>They charge for this service, and I processed around 21,000 captchas, which cost $3—a fair price. In the next part, I’ll talk about how to integrate it with the Requests package, or with Selenium if you prefer to stick to the traditional method.</p>
<p>The service I used is <a href="https://www.chaojiying.com/">Chaojiying</a>. It provides <a href="https://www.chaojiying.com/download/Chaojiying_Python.rar">a Python function</a>, which can be imported to your python program like this:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">chaojiying</span> <span class="c1"># Download this part at Chaojiying website
</span><span class="kn">from</span> <span class="nn">chaojiying</span> <span class="kn">import</span> <span class="n">Chaojiying_Client</span>

<span class="k">def</span> <span class="nf">solveCaptcha</span><span class="p">():</span>
    <span class="n">url1</span> <span class="o">=</span> <span class="s">"URL FOR FETCHING CAPTCHA MODULE"</span>
    <span class="n">params1</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'type'</span><span class="p">:</span> <span class="s">'test'</span>  
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url1</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params1</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="s">'img'</span><span class="p">]</span>
    <span class="n">img_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="s">'id'</span><span class="p">]</span>
    
    <span class="c1"># Decode and save the captcha image
</span>    <span class="n">img_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'captcha.png'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">img_bytes</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'captcha.png'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    
    <span class="n">chaojiying</span> <span class="o">=</span> <span class="n">Chaojiying_Client</span><span class="p">(</span><span class="s">'CHAOJIYING USER NAME'</span><span class="p">,</span> <span class="s">'CHAOJIYING USER PASSWORD'</span><span class="p">,</span> <span class="s">'CHAOJIYING ID'</span><span class="p">)</span>  <span class="c1"># Replace with valid credentials, have to sign up the account first
</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">chaojiying</span><span class="p">.</span><span class="n">PostPic</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">1004</span><span class="p">)</span>  <span class="c1"># Adjust captcha type ID (1004) if needed
</span>    
    <span class="c1"># Submit the solved captcha
</span>    <span class="n">url2</span> <span class="o">=</span> <span class="s">"URL FOR CHECKING CAPTCHA MODULE"</span>  
    <span class="n">params2</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'id'</span><span class="p">:</span> <span class="n">img_id</span><span class="p">,</span>
        <span class="s">'captcha'</span><span class="p">:</span> <span class="n">res</span><span class="p">[</span><span class="s">"pic_str"</span><span class="p">],</span>
        <span class="s">'type'</span><span class="p">:</span> <span class="s">'test'</span>
    <span class="p">}</span>
    
    <span class="c1"># Send the solved captcha
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url2</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params2</span><span class="p">)</span>
</code></pre></div></div>
<p>There are many other companies that provide such services, but I haven’t tried them yet. I list them below for your reference:</p>
<ul>
<li><a href="https://www.jfbym.com/">Yun Ma</a></li>
<li><a href="https://anti-captcha.com/">Anti Captcha</a></li>
<li><a href="https://2captcha.com/">2Captcha</a></li>
<li><a href="https://www.capsolver.com/">CapSolver</a></li>
</ul>
<h2 id="try-requests-if-you-have-trouble-setting-selenium">Try Requests if You Have Trouble Setting Selenium</h2>
<p>If you’re having trouble with Selenium, or if you’re tired of dealing with XPaths, you might want to try directly retrieving information from the server database. The way to do this is to use an API.</p>
<p>First, you need to figure out the API format. Right-click on the web page, select “Inspect” in Chrome, and click the Network tab at the top. Now, you can inspect the communication between the front end and the back end.</p>
<p>For example, I use <a href="https://talk.jekyllrb.com/">Jekyll Talk</a>. When I click on the link of interest, the Network panel changes.</p>
<p><img src="/assets/network_panel.png" alt="Network panel changed"></p>
<p>This gives us information about the API request headers and response headers. Therefore, by reconstructing this information ourselves, we can simulate API requests and retrieve responses in JSON format.</p>
<p>Here’s a simple code snippet demonstrating how to use the Requests package in Python to fetch information from the server:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">INSERT</span> <span class="n">YOUR</span> <span class="n">HEADERS</span> <span class="n">HERE</span><span class="p">}</span> <span class="c1"># You can find your headers in the Inspect panel, or you can fake one
</span><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="n">INSERT</span> <span class="n">YOUR</span> <span class="n">COOKIES</span> <span class="n">HERE</span><span class="p">}</span> <span class="c1"># You can also find your cookies in the Inspect panel; cookies may change with your login status
</span><span class="n">url</span> <span class="o">=</span> <span class="s">""</span>  <span class="c1"># Insert the API endpoint here
</span><span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Parameters of the website can be seen in 'General -&gt; Request URL'
</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">())</span>  <span class="c1"># Get your response in JSON format
</span></code></pre></div></div>
<p>Some benefits of doing so:</p>
<ol>
<li>Easily get all content directly from the database, which also includes some non-displayed or hard-to-fetch content.</li>
<li>It’s way faster than Selenium.</li>
<li>It’s way easier than Selenium.</li>
</ol>
<h2 id="captcha-solver--requests">Captcha Solver + Requests</h2>
<p>If we want to combine the two, the logic would be simple:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">Captcha</span><span class="p">:</span>
    <span class="n">get</span> <span class="n">captcha</span> <span class="k">from</span> <span class="n">web</span> <span class="n">server</span>
    <span class="n">download</span> <span class="n">captcha</span>
    <span class="n">upload</span> <span class="n">captcha</span> <span class="n">to</span> <span class="n">captcha</span> <span class="n">solver</span> <span class="n">server</span>
    <span class="n">get</span> <span class="n">captcha</span> <span class="n">key</span>
    <span class="n">send</span> <span class="n">captcha</span> <span class="n">key</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">get</span> <span class="n">content</span> <span class="k">with</span> <span class="n">requests</span>
</code></pre></div></div>
<p>This article will be continued and refined. Feel free to email me or leave a comment if you have any questions.</p>
<span class="meta"> <time datetime="2024-10-07T00:00:00-04:00">October 7, 2024</time> · <a href="/tag/computational">computational</a>, <a href="/tag/English">English</a> </span><div id="vcomments"></div></section><script src="/assets/js/copyCode.js"></script> <script src="/Valine.min.js"></script> <script> new Valine({ el:'#vcomments', appId: 'deLvV5QEsweui1qehWIOKa6h-gzGzoHsz', appKey: '5rlOhiv7dVJoeVuohXfQjzpP', avatar: "mp" }) </script></main></body>
</html>
